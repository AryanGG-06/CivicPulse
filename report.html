<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Report Issue - CivicPulse</title>
<link rel="stylesheet" href="styles.css">
<style> 
  header, footer { background: #2563eb; color: #fff; text-align: center; padding: 1.2rem 0; font-weight: 700; font-size: 1.2rem; }
   nav { margin-top: 1rem; }
  nav a { color: #fff; text-decoration: none; margin: 0 1.3rem; font-weight: 600; }
  nav a:hover, nav a.selected { color: #ffe266; text-decoration: underline; }
  h1.logo { font-size: 2.2rem; margin: 0; }
  </style>
</head>
<body>
<header>

  <h1 class="logo">CivicPulse</h1>
  <nav>
    <a href="index.html" >Home</a>
    <a href="report.html"class="selected">Report Issue</a>
    <a href="dashboard.html">My Dashboard</a>
    <a href="complaints.html">Issues Registered</a>
    <a href="track.html" >Track Issue</a>
  </nav>

</header>
<div class="container">
  <h2>Report a Civic Issue</h2>
  <form id="report-form" novalidate>
    <label for="issue-type">Issue Type *</label>
    <select id="issue-type" name="issue-type" required>
      <option value="" disabled selected>Select an issue</option>
      <option value="Garbage">Garbage</option>
      <option value="Pothole">Pothole</option>
      <option value="Streetlight Issue">Streetlight Issue</option>
      <option value="Water Leakage">Water Leakage</option>
      <option value="Other">Other</option>
    </select>
    <label for="photo">Upload a Photo *</label>
    <input type="file" id="photo" name="photo" accept="image/*" capture="environment" />
    <img id="photo-preview" style="display:none;max-width:200px;margin-top:10px;" />

    <label for="location">Location (Address or GPS coordinates) *</label>
    <input type="text" id="location" name="location" placeholder="Enter location or select on map" required />
    <button type="button" id="use-gps" class="btn-small">Use My Location</button>
    <div id="map" style="height: 250px; margin-top: 15px; border-radius:6px;"></div>

    <label for="description">Description (optional)</label>
    <textarea id="description" name="description" placeholder="Additional details about the issue"></textarea>
    <button type="submit" style="margin-top: 1.3rem;">Submit Report</button>
  </form>
</div>


<footer>
  &copy; 2025 CivicPulse. All rights reserved.
</footer>
<script>
let map, marker;
function initMap() {
  const defaultCenter = { lat: 20.5937, lng: 78.9629 };
  map = new google.maps.Map(document.getElementById("map"), {
    center: defaultCenter, zoom: 5
  });
  marker = new google.maps.Marker({
    position: defaultCenter, map: map, draggable: true
  });
  marker.addListener("dragend", () => {
    const pos = marker.getPosition();
    document.getElementById("location").value = `Lat: ${pos.lat().toFixed(6)}, Lng: ${pos.lng().toFixed(6)}`;
  });
}
const locationInput = document.getElementById("location");
document.getElementById("use-gps").onclick = function() {
  if (!navigator.geolocation) return alert("Geolocation not available.");
  this.disabled=true; this.textContent="Locating...";
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude, lng = pos.coords.longitude;
      const loc = new google.maps.LatLng(lat, lng);
      map.setCenter(loc); map.setZoom(15);
      marker.setPosition(loc);
      document.getElementById("location").value = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
      this.disabled=false;this.textContent="Use My Location";
    },
    () => { alert("Could not get location."); this.disabled=false;this.textContent="Use My Location";}
  );
};
const photoInput = document.getElementById('photo'),
      previewImg = document.getElementById('photo-preview');
photoInput.onchange = function(e) {
  const f = e.target.files[0];
  if (!f) { previewImg.style.display = "none"; previewImg.src=""; return;}
  previewImg.src = URL.createObjectURL(f); previewImg.style.display="block";
};
// Form submit
document.getElementById('report-form').onsubmit = function(e) {
  e.preventDefault();
  const issueType = document.getElementById('issue-type').value;
  const location = locationInput.value;
  if (!issueType || !location) {
    alert("Select issue type and location!");
    return;
  }
  // Create 13-digit tracking ID
  const trackId = Date.now().toString() + Math.floor(Math.random()*900 + 100).toString();
  // Save complaint to sessionStorage (append to other reports)
  sessionStorage.setItem('lastReport', JSON.stringify({
    type: issueType,
    desc: document.getElementById('description').value,
    photo: "", // not persisted in session, just for demo
    location
  }));
  window.location = `submitted.html?track_id=${trackId}`;
};
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7xnLivgGyzJ_lh7recfxkxtdCv8kwm10&callback=initMap" async defer></script>
</body>
</html>
